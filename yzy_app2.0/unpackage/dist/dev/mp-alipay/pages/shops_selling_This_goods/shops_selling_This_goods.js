(my["webpackJsonp"]=my["webpackJsonp"]||[]).push([["pages/shops_selling_This_goods/shops_selling_This_goods"],{198:function(t,e,n){"use strict";(function(t){var e=n(3);n(22);e(n(21));var s=e(n(199));my.__webpack_require_UNI_MP_PLUGIN__=n,t(s.default)}).call(this,n(1)["createPage"])},199:function(t,e,n){"use strict";n.r(e);var s=n(200),o=n(202);for(var i in o)["default"].indexOf(i)<0&&function(t){n.d(e,t,(function(){return o[t]}))}(i);n(204);var r,u=n(68),c=Object(u["default"])(o["default"],s["render"],s["staticRenderFns"],!1,null,null,null,!1,s["components"],r);c.options.__file="pages/shops_selling_This_goods/shops_selling_This_goods.vue",e["default"]=c.exports},200:function(t,e,n){"use strict";n.r(e);var s=n(201);n.d(e,"render",(function(){return s["render"]})),n.d(e,"staticRenderFns",(function(){return s["staticRenderFns"]})),n.d(e,"recyclableRender",(function(){return s["recyclableRender"]})),n.d(e,"components",(function(){return s["components"]}))},201:function(t,e,n){"use strict";var s;n.r(e),n.d(e,"render",(function(){return o})),n.d(e,"staticRenderFns",(function(){return r})),n.d(e,"recyclableRender",(function(){return i})),n.d(e,"components",(function(){return s}));try{s={uniPopup:function(){return n.e("uni_modules/uni-popup/components/uni-popup/uni-popup").then(n.bind(null,521))},uniTag:function(){return n.e("uni_modules/uni-tag/components/uni-tag/uni-tag").then(n.bind(null,528))}}}catch(u){if(-1===u.message.indexOf("Cannot find module")||-1===u.message.indexOf(".vue"))throw u;console.error(u.message),console.error("1. 排查组件名称拼写是否正确"),console.error("2. 排查组件是否符合 easycom 规范，文档：https://uniapp.dcloud.net.cn/collocation/pages?id=easycom"),console.error("3. 若组件不符合 easycom 规范，需手动引入，并在 components 中注册该组件")}var o=function(){var t=this,e=t.$createElement,n=(t._self._c,t.__map(t.filterRule.businessUnit,(function(e,n){var s=t.__get_orig(e),o=t.getTagType(e);return{$orig:s,m0:o}})));t.$mp.data=Object.assign({},{$root:{l0:n}})},i=!1,r=[];o._withStripped=!0},202:function(t,e,n){"use strict";n.r(e);var s=n(203),o=n.n(s);for(var i in s)["default"].indexOf(i)<0&&function(t){n.d(e,t,(function(){return s[t]}))}(i);e["default"]=o.a},203:function(t,e,n){"use strict";(function(t,s){var o=n(3);Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=o(n(26)),r=o(n(28)),u=o(n(29)),c=function(){n.e("components/goods/goods_card").then(function(){return resolve(n(535))}.bind(null,n)).catch(n.oe)},a=function(){n.e("components/shop/shop_card").then(function(){return resolve(n(556))}.bind(null,n)).catch(n.oe)},l={data:function(){return{goods:{},choiceBar:"test1",sortRule:"距离",filterRule:{businessUnit:[]},useFilterRule:{businessUnit:[]},useFilter:!1,filterShopList:[],shopsList:[],latitude:null,longitude:null,firstClickLocation:!0}},components:{goodsCard:c,shopCard:a},mounted:function(){this.getShops(102,24)},onLoad:function(t){this.goods=JSON.parse(decodeURIComponent(t.goods))},onUnload:function(){console.log("关闭实时定位")},computed:{filteredShopsList:function(){var t=this;return 0==this.useFilterRule.businessUnit.length?this.shopsList:this.shopsList.filter((function(e){return t.useFilterRule.businessUnit.some((function(t){return t===e.businessUnitName}))}))}},methods:{resetFilterRule:function(){this.useFilterRule.businessUnit=[],this.filterShopList=this.shopsList},getTagType:function(t){var e=this.useFilterRule.businessUnit.some((function(e){return e===t}));return e?"primary":""},clickBusinessUnit:function(t,e){var n=this.useFilterRule.businessUnit.findIndex((function(e){return e===t}));-1===n?this.useFilterRule.businessUnit.push(t):this.useFilterRule.businessUnit.splice(n,1),0!=this.useFilterRule.businessUnit.length?this.useFilter=!0:this.useFilter=!1},createfilterRule:function(t){var e=new Set;t.forEach((function(t){e.add(t.businessUnitName)})),this.filterRule.businessUnit=Array.from(e)},toGoodsDetails:function(e,n){console.log(e),t.navigateTo({url:"/pages/goods_details/goods_details?goods="+encodeURIComponent(JSON.stringify(e))+"&shop="+encodeURIComponent(JSON.stringify(n))})},selectBar:function(e,n){console.log(e);var s=this;"test4"!=e&&(this.choiceBar=e);var o=this.sortRule;return"test1"==e?(this.sortRule="距离",void(this.firstClickLocation?t.startLocationUpdate({success:function(e){console.log("startLocationUpdate用户开启使用小程序期间位置权限:",e),t.onLocationChange((function(t){s.latitude=t.latitude,s.longitude=t.longitude,s.shopsList.forEach((function(t){t.distance=s.calculateDistance(t.latitude,t.longitude)})),s.firstClickLocation=!1,s.sortShopsList(s.sortRule)}))},fail:function(e){console.log("startLocationUpdate获取当前位置失败",e),t.showModal({title:"授权",content:"需要授权才能获取位置信息",success:function(t){if(t.confirm)s.authVerification();else if(t.cancel)return void s.selectBar("test0","")}})}}):s.sortShopsList(s.sortRule))):("test2"==e&&(this.sortRule="库存"),"test3"==e&&"price"==n?("价格升序"==o&&"价格降序"==o||(this.sortRule="价格降序"),"价格升序"==o&&(this.sortRule="价格降序"),"价格降序"==o&&(this.sortRule="价格升序"),void this.sortShopsList(this.sortRule)):("test4"==e&&this.$refs.popup.open("right"),"test0"==e&&(this.sortRule="默认"),this.sortShopsList(this.sortRule),void t.hideLoading()))},authVerification:function(){var e=this,n=this;t.getSetting({success:function(t){t.authSetting["scope.userLocation"]?n.selectBar("test1",""):void 0===t.authSetting["scope.userLocation"]?(console.log("没有授权"),e.handleOpenSetting()):e.handleOpenSetting()}})},handleOpenSetting:function(){var e=this;s.openSetting({success:function(n){console.log("定位 openSetting",n),n.authSetting["scope.userLocation"]?e.selectBar("test1",""):(t.showToast({title:"授权失败",icon:"none"}),e.selectBar("test0",""))}})},sortShopsList:function(e){"价格降序"==e&&this.shopsList.sort((function(t,e){return t.price-e.price})),"价格升序"==e&&this.shopsList.sort((function(t,e){return e.price-t.price})),"库存"!=e&&"默认"!=e||this.shopsList.sort((function(t,e){return e.inventory-t.inventory})),"距离"==e&&(this.shopsList.sort((function(t,e){return t.distance-e.distance})),t.hideLoading())},calculateDistance:function(t,e){var n=6371,s=this.degreesToRadians(t-this.latitude),o=this.degreesToRadians(e-this.longitude),i=Math.sin(s/2)*Math.sin(s/2)+Math.cos(this.degreesToRadians(this.latitude))*Math.cos(this.degreesToRadians(t))*Math.sin(o/2)*Math.sin(o/2),r=2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i)),u=n*r;return u.toFixed(2)},degreesToRadians:function(t){return t*(Math.PI/180)},getShops:function(e,n){var s=this;return(0,r.default)(i.default.mark((function o(){var r,c,a,l;return i.default.wrap((function(o){while(1)switch(o.prev=o.next){case 0:return s.latitude=n,s.longitude=e,console.log(s.latitude),t.showLoading({title:"搜索中.."}),s,console.log("查询门店"),r="/api/shop/searchShops",c="POST",a={goods_json:s.goods,latitude:n,longitude:e,goodsId:s.goods.goodsId},o.prev=9,o.next=12,(0,u.default)("yzy_app",r,c,a);case 12:l=o.sent,console.log(l),99==l.code?(s.shopsList=l.data.data,s.createfilterRule(l.data.data),s.selectBar("test1",""),setTimeout((function(){t.hideLoading()}),1e3)):t.hideLoading(),o.next=20;break;case 17:o.prev=17,o.t0=o["catch"](9),t.hideLoading();case 20:case"end":return o.stop()}}),o,null,[[9,17]])})))()},getUserLocation:function(){console.log("获取位置");var e=this;t.getLocation({type:"gcj02",success:function(t){console.log(t),e.getShops(t.longitude,t.latitude)},fail:function(t){}})}}};e.default=l}).call(this,n(1)["default"],n(1)["default"])},204:function(t,e,n){"use strict";n.r(e);var s=n(205),o=n.n(s);for(var i in s)["default"].indexOf(i)<0&&function(t){n.d(e,t,(function(){return s[t]}))}(i);e["default"]=o.a},205:function(t,e,n){}},[[198,"common/runtime","common/vendor"]]]);