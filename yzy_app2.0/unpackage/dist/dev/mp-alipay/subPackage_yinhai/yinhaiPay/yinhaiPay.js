(my["webpackJsonp"]=my["webpackJsonp"]||[]).push([["subPackage_yinhai/yinhaiPay/yinhaiPay"],{469:function(e,n,t){"use strict";(function(e){var n=t(3);t(22);n(t(21));var r=n(t(470));my.__webpack_require_UNI_MP_PLUGIN__=t,e(r.default)}).call(this,t(1)["createPage"])},470:function(e,n,t){"use strict";t.r(n);var r=t(471),o=t(473);for(var a in o)["default"].indexOf(a)<0&&function(e){t.d(n,e,(function(){return o[e]}))}(a);t(475);var i,c=t(68),s=Object(c["default"])(o["default"],r["render"],r["staticRenderFns"],!1,null,null,null,!1,r["components"],i);s.options.__file="subPackage_yinhai/yinhaiPay/yinhaiPay.vue",n["default"]=s.exports},471:function(e,n,t){"use strict";t.r(n);var r=t(472);t.d(n,"render",(function(){return r["render"]})),t.d(n,"staticRenderFns",(function(){return r["staticRenderFns"]})),t.d(n,"recyclableRender",(function(){return r["recyclableRender"]})),t.d(n,"components",(function(){return r["components"]}))},472:function(e,n,t){"use strict";var r;t.r(n),t.d(n,"render",(function(){return o})),t.d(n,"staticRenderFns",(function(){return i})),t.d(n,"recyclableRender",(function(){return a})),t.d(n,"components",(function(){return r}));var o=function(){var e=this,n=e.$createElement;e._self._c},a=!1,i=[];o._withStripped=!0},473:function(e,n,t){"use strict";t.r(n);var r=t(474),o=t.n(r);for(var a in r)["default"].indexOf(a)<0&&function(e){t.d(n,e,(function(){return r[e]}))}(a);n["default"]=o.a},474:function(e,n,t){"use strict";(function(e,r){var o=t(3);Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var a=o(t(26)),i=o(t(28)),c=o(t(10)),s=o(t(29));function l(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function u(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?l(Object(t),!0).forEach((function(n){(0,c.default)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):l(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var d=requirePlugin("yh-pay-plugin"),p={data:function(){var e;return e={createOrderParam:null,cash_url:"",eventChannel:null,payOver:!1},(0,c.default)(e,"cash_url",null),(0,c.default)(e,"main_order_id",null),(0,c.default)(e,"pollingInterval",3e3),(0,c.default)(e,"pollingTimer",null),e},onUnload:function(){this.stopPolling()},beforeDestroy:function(){this.stopPolling()},onShow:function(){this.main_order_id},onLoad:function(n){if(n.orderInfo){this.createOrderParam=JSON.parse(decodeURIComponent(n.orderInfo));var t=this;console.log("初始化银海插件"),console.log(t.createOrderParam),e.showLoading({title:"加载中...",mask:!0}),e.login({success:function(e){d.init({url:"https://zhuguangcao.mynatapp.cc/yy",dppSyscode:t.createOrderParam.dppSyscode,dsmpSyscode:"1002100022",authCode:e.code,chnlAppId:"wxe7c826a1a5e00055",acssToken:t.createOrderParam.acssToken}).then((function(e){console.log("插件初始化成功1"),t.CreateOrder()})).catch((function(e){console.log("插件初始化失败1：".concat(e.errMsg))}))}})}if(n.main_order_id){var r=JSON.parse(decodeURIComponent(n.main_order_id)),o=JSON.parse(decodeURIComponent(n.cash_url));this.cash_url="plugin://yh-pay-plugin/"+o,this.main_order_id=r,this.getInitParam(r,o)}},methods:{goToBuy:function(){e.reLaunch({url:"/pages/index/index"})},goToOrder:function(){e.redirectTo({url:"/pages/user_order/user_order"})},getInitParam:function(n,t){var r=this;return(0,i.default)(a.default.mark((function o(){var i,c,l,u,p;return a.default.wrap((function(o){while(1)switch(o.prev=o.next){case 0:return e.showLoading({title:"初始化...",mask:!0}),i=r,c="/api/trade/getYhInitParam",l="POST",u={main_order_id:n,payType:"微信医保支付"},o.prev=5,o.next=8,(0,s.default)("yzy_app",c,l,u);case 8:p=o.sent,console.log(p),99==p.code&&e.login({success:function(r){d.init({url:"https://zhuguangcao.mynatapp.cc/yy",dppSyscode:p.data.dppSyscode,dsmpSyscode:"1002100022",authCode:r.code,chnlAppId:"wxe7c826a1a5e00055",acssToken:p.data.acssToken}).then((function(e){console.log("插件初始化成功1"),i.OpenPay("plugin://yh-pay-plugin/"+t,n)})).catch((function(n){console.log("插件初始化失败1：".concat(n.errMsg)),e.showToast({title:"初始化失败!请返回重试!",icon:"none"})}))}}),o.next=16;break;case 13:o.prev=13,o.t0=o["catch"](5),console.log(o.t0);case 16:case"end":return o.stop()}}),o,null,[[5,13]])})))()},CreateOrder:function(){var n=this,t=this;console.log("创建银海订单"),d.createOrderDsmp({medins_code:this.createOrderParam.medins_code,medins_name:this.createOrderParam.medins_name,opter_type:"102",opter_id:this.createOrderParam.yinhaiCreateOrderObject.acss_sys_ord_no,opter_name:"***",input_data:this.createOrderParam.yinhaiCreateOrderObject}).then((function(e){console.log(e),console.log(e.data.cash_url);var r="plugin://yh-pay-plugin/"+e.data.cash_url;console.log(r),n.cash_url=r,n.main_order_id=n.createOrderParam.yinhaiCreateOrderObject.acss_sys_ord_no,t.saveResData(e.data,n.createOrderParam.yinhaiCreateOrderObject.acss_sys_ord_no,r,"付款")})).catch((function(n){console.log("err:".concat(JSON.stringify(n))),e.showToast({title:"加载失败!请重新下单!",icon:"none"}),setTimeout((function(){e.navigateBack()}),1e3)}))},saveResData:function(n,t,r,o){var c=this;return(0,i.default)(a.default.mark((function i(){var l,u,d,p,f;return a.default.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return l=c,u="/api/trade/updateYinHaiOrderInfo",d="POST",p={orderInfo:n,main_order_id:t,type:o},a.prev=4,a.next=7,(0,s.default)("yzy_app",u,d,p);case 7:f=a.sent,console.log(f),99==f.code?l.OpenPay(r,t):e.showToast({title:"保存订单失败!请重新下单!",icon:"none"}),a.next=16;break;case 12:a.prev=12,a.t0=a["catch"](4),console.log(a.t0),e.showToast({title:"保存订单失败!请重新下单!",icon:"none"});case 16:case"end":return a.stop()}}),i,null,[[4,12]])})))()},OpenPay2:function(){var n=this;console.log(this.cash_url),e.navigateTo({url:n.cash_url,events:{wxPayEvent:function(t){console.log("wxPayEvent data:".concat(JSON.stringify(t))),r.requestPayment(u(u({},t),{},{complete:function(t){n.eventChannel.emit("wxPaymentComplete",t),console.log("微信支付操作完成 res: ".concat(JSON.stringify(t))),console.log(t),"requestPayment:fail cancel"==t.errMsg?n.queryOrder(n.main_order_id,"付款"):(n.queryOrder(n.main_order_id,"付款"),n.payOver=!0,e.redirectTo({url:"/pages/user_order/user_order"}))}}))}},success:function(e){n.eventChannel=e.eventChannel},fail:function(){e.showToast({title:"打开支付页失败!请前往订单中心重新点击支付!",icon:"none"}),setTimeout((function(){e.navigateBack()}),1e3)}})},OpenPay:function(n,t){e.hideLoading();var o=this;this.main_order_id=t,this.startPolling(t),console.log(n),e.navigateTo({url:n,events:{wxPayEvent:function(e){console.log("wxPayEvent data:".concat(JSON.stringify(e))),r.requestPayment(u(u({},e),{},{complete:function(e){o.eventChannel.emit("wxPaymentComplete",e),console.log("微信支付操作完成 res: ".concat(JSON.stringify(e))),console.log(e),"requestPayment:fail cancel"==e.errMsg||(o.payOver=!0,r.redirectTo({url:"/pages/user_order/user_order"}))}}))}},success:function(e){o.eventChannel=e.eventChannel}})},queryOrder:function(n,t){var r=this;return(0,i.default)(a.default.mark((function o(){var i,c,l,u;return a.default.wrap((function(o){while(1)switch(o.prev=o.next){case 0:return i="/api/Trade/requestYinhaiQueryOrder",c="POST",l={main_order_id:n,type:t},o.prev=3,o.next=6,(0,s.default)("yzy_app",i,c,l);case 6:u=o.sent,console.log(u),99==u.code&&"2"==u.data&&(r.payOver=!0,r.stopPolling(),console.log("支付成功"),e.hideLoading()),o.next=14;break;case 11:o.prev=11,o.t0=o["catch"](3),console.log(o.t0);case 14:case"end":return o.stop()}}),o,null,[[3,11]])})))()},pollingMethod:function(n){e.showLoading({title:"查询中..."}),console.log("轮询调用的方法");var t=this.main_order_id;n&&(t=n),this.queryOrder(t,"付款"),this.startPolling(t)},startPolling:function(e){var n=this;this.pollingTimer&&(clearTimeout(this.pollingTimer),this.pollingTimer=null),this.pollingTimer=setTimeout((function(){n.pollingMethod(e)}),this.pollingInterval)},stopPolling:function(){this.pollingTimer&&(clearTimeout(this.pollingTimer),this.pollingTimer=null)}}};n.default=p}).call(this,t(1)["default"],t(1)["default"])},475:function(e,n,t){"use strict";t.r(n);var r=t(476),o=t.n(r);for(var a in r)["default"].indexOf(a)<0&&function(e){t.d(n,e,(function(){return r[e]}))}(a);n["default"]=o.a},476:function(e,n,t){}},[[469,"common/runtime","common/vendor"]]]);