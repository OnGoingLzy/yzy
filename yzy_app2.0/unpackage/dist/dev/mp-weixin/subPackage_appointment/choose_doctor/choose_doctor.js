(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["subPackage_appointment/choose_doctor/choose_doctor"],{459:function(e,t,n){"use strict";(function(e,t){var o=n(4);n(26);o(n(25));var a=o(n(460));e.__webpack_require_UNI_MP_PLUGIN__=n,t(a.default)}).call(this,n(1)["default"],n(2)["createPage"])},460:function(e,t,n){"use strict";n.r(t);var o=n(461),a=n(463);for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);n(465);var i,c=n(72),s=Object(c["default"])(a["default"],o["render"],o["staticRenderFns"],!1,null,null,null,!1,o["components"],i);s.options.__file="subPackage_appointment/choose_doctor/choose_doctor.vue",t["default"]=s.exports},461:function(e,t,n){"use strict";n.r(t);var o=n(462);n.d(t,"render",(function(){return o["render"]})),n.d(t,"staticRenderFns",(function(){return o["staticRenderFns"]})),n.d(t,"recyclableRender",(function(){return o["recyclableRender"]})),n.d(t,"components",(function(){return o["components"]}))},462:function(e,t,n){"use strict";var o;n.r(t),n.d(t,"render",(function(){return a})),n.d(t,"staticRenderFns",(function(){return i})),n.d(t,"recyclableRender",(function(){return r})),n.d(t,"components",(function(){return o}));try{o={uniPopup:function(){return n.e("uni_modules/uni-popup/components/uni-popup/uni-popup").then(n.bind(null,525))}}}catch(c){if(-1===c.message.indexOf("Cannot find module")||-1===c.message.indexOf(".vue"))throw c;console.error(c.message),console.error("1. 排查组件名称拼写是否正确"),console.error("2. 排查组件是否符合 easycom 规范，文档：https://uniapp.dcloud.net.cn/collocation/pages?id=easycom"),console.error("3. 若组件不符合 easycom 规范，需手动引入，并在 components 中注册该组件")}var a=function(){var e=this,t=e.$createElement,n=(e._self._c,e.filterDoctor.length);e.$mp.data=Object.assign({},{$root:{g0:n}})},r=!1,i=[];a._withStripped=!0},463:function(e,t,n){"use strict";n.r(t);var o=n(464),a=n.n(o);for(var r in o)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return o[e]}))}(r);t["default"]=a.a},464:function(e,t,n){"use strict";(function(e){var o=n(4);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=o(n(30)),r=o(n(32)),i=o(n(33)),c={data:function(){return{doctor:[],hospital:null,departmentSubClass:{},sevenDays:[],selectedIndex:0,selectedDate:null,filterDoctor:[],clickDoctor:null,schedule:null,day:""}},onLoad:function(e){this.hospital=JSON.parse(decodeURIComponent(e.hospital)),this.departmentSubClass=JSON.parse(decodeURIComponent(e.departmentSubClass)),this.generateSevenDays()},mounted:function(){this.selectDay(0)},methods:{toSubmitAppointment:function(t){console.log(t);var n=this.departmentSubClass.departmentName?this.departmentSubClass.departmentName:"";e.redirectTo({url:"/subPackage_appointment/appointment/submit_appointment?date="+encodeURIComponent(JSON.stringify(this.selectedDate))+"&schedule="+encodeURIComponent(JSON.stringify(t))+"&hospital="+encodeURIComponent(JSON.stringify(this.hospital))+"&departmentInfo="+encodeURIComponent(JSON.stringify(n+"-"+this.departmentSubClass.subclassName))+"&doctor="+encodeURIComponent(JSON.stringify(this.clickDoctor.name+" "+this.clickDoctor.position))})},setSchedule:function(){if(this.clickDoctor&&this.clickDoctor.schedule){var e=new Date(this.selectedDate),t=(e.toISOString().split("T")[0],this.clickDoctor.schedule.filter((function(t){var n=new Date(t.startWorkTime),o=new Date(t.endWorkTime);return e>=n&&e<=o})));this.schedule=t}},openChooseSchedule:function(e){this.clickDoctor=e,this.setSchedule(),this.$refs.popup.open("right")},filterDoctorsByDate:function(){console.log("筛选医生");for(var e=this.selectedDate,t=this.day,n=[],o=this.doctor.length,a=0;a<o;a++){var r=this.doctor[a];if(r.schedule)for(var i=r.schedule.length,c=0;c<i;c++){var s=r.schedule[c],u=new Date(s.startWorkTime),d=new Date(s.endWorkTime),l=new Date(e),p="周六"===t||"周日"===t,f="y"===s.isWeekendWork;if(l>=u&&l<=d&&(!p||f)){n.push(r);break}}}console.log(n),this.filterDoctor=n},calculateRemainedNum:function(){this.filterDoctor.forEach((function(e){var t=0;e.schedule&&e.schedule.forEach((function(e){t+=(e.limitNum||0)-(e.alreadyAppointmentNum||0)})),e.remainedNum=t}))},generateSevenDays:function(){for(var e=["周日","周一","周二","周三","周四","周五","周六"],t=new Date,n=0;n<7;n++){var o=new Date(t);o.setDate(t.getDate()+n);var a=e[o.getDay()],r=(o.getMonth()+1).toString().padStart(2,"0"),i=o.getDate().toString().padStart(2,"0"),c="".concat(r,"-").concat(i);0===n?this.sevenDays.push({date:c,day:"今天"}):this.sevenDays.push({date:c,day:a})}},selectDay:function(t){e.showLoading({title:"loading...",mask:!0});var n=new Date,o=n.getFullYear();this.selectedIndex=t,this.selectedDate=o+"-"+this.sevenDays[t].date,this.day=this.sevenDays[t].day;this.getDoctor(this.selectedDate,"day")},getDoctor:function(t,n){var o=this;return(0,r.default)(a.default.mark((function r(){var c,s,u,d,l;return a.default.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return c=o,s="/api/appointment/getDoctor",u="POST",d={departmentSubClassId:o.departmentSubClass.id,hospitalId:o.hospital.id,type:n,date:t},a.prev=4,a.next=7,(0,i.default)("yzy_app",s,u,d);case 7:l=a.sent,console.log(l),99==l.code&&l.data.data?"week"==n?(o.doctor=l.data.data,setTimeout((function(){c.calculateRemainedNum(),e.hideLoading()}),500)):(o.doctor=l.data.data,setTimeout((function(){c.filterDoctorsByDate(),c.calculateRemainedNum(),e.hideLoading()}),500)):e.showToast({title:"没有查到任何数据",icon:"none"}),a.next=15;break;case 12:a.prev=12,a.t0=a["catch"](4),console.log(a.t0);case 15:case"end":return a.stop()}}),r,null,[[4,12]])})))()}}};t.default=c}).call(this,n(2)["default"])},465:function(e,t,n){"use strict";n.r(t);var o=n(466),a=n.n(o);for(var r in o)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return o[e]}))}(r);t["default"]=a.a},466:function(e,t,n){}},[[459,"common/runtime","common/vendor"]]]);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/subPackage_appointment/choose_doctor/choose_doctor.js.map