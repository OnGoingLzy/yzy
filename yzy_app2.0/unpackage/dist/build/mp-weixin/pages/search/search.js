(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/search/search"],{"0cd0":function(e,t,r){},"1b8f":function(e,t,r){"use strict";r.d(t,"b",(function(){return o})),r.d(t,"c",(function(){return a})),r.d(t,"a",(function(){return s}));var s={uniTag:function(){return r.e("uni_modules/uni-tag/components/uni-tag/uni-tag").then(r.bind(null,"ccec"))},uniIcons:function(){return Promise.all([r.e("common/vendor"),r.e("uni_modules/uni-icons/components/uni-icons/uni-icons")]).then(r.bind(null,"f79a"))},uniPopup:function(){return r.e("uni_modules/uni-popup/components/uni-popup/uni-popup").then(r.bind(null,"0336"))}},o=function(){var e=this,t=e.$createElement,r=(e._self._c,e.searchResults.length),s=e.searchResults.length,o=e.__map(e.filterRule.manufacturer,(function(t,r){var s=e.__get_orig(t),o=e.getTagType(t,"生产厂商");return{$orig:s,m0:o}})),a=e.__map(e.filterRule.goodsName,(function(t,r){var s=e.__get_orig(t),o=e.getTagType(t,"品牌名");return{$orig:s,m1:o}}));e._isMounted||(e.e0=function(e){return this.$refs.popup.close()}),e.$mp.data=Object.assign({},{$root:{g0:r,g1:s,l0:o,l1:a}})},a=[]},"31fa":function(e,t,r){"use strict";(function(e){var s=r("4ea4");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=s(r("2eee")),a=s(r("448a")),n=s(r("c973")),i=s(r("24db"));function u(e,t){var r="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"===typeof e)return c(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return c(e,t)}(e))||t&&e&&"number"===typeof e.length){r&&(e=r);var s=0,o=function(){};return{s:o,n:function(){return s>=e.length?{done:!0}:{done:!1,value:e[s++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,n=!0,i=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return n=e.done,e},e:function(e){i=!0,a=e},f:function(){try{n||null==r.return||r.return()}finally{if(i)throw a}}}}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,s=new Array(t);r<t;r++)s[r]=e[r];return s}var l={data:function(){return{showType:"列表",hotList:[],historyList:[],showView:"view1",searchContent:"",searchResults:[],filterSearchResults:[],searchTime:1,isloding:!0,totalNum:"",choiceBar:"test0",searchObj:{searchContent:"",pageIndex:1,pageSize:20,drugsList:[],sortRule:"默认",filterRule:"无"},maySearchList:[],filterRule:{manufacturer:[],goodsName:[]},useFilterRule:{manufacturer:[],goodsName:[]},useFilter:!1,focus:!1,isCategorySearch:!1,categoryId:""}},components:{goodsCard:function(){r.e("components/goods/goods_card").then(function(){return resolve(r("0faa"))}.bind(null,r)).catch(r.oe)},goodsCard2:function(){r.e("components/goods/goods_card2").then(function(){return resolve(r("9035"))}.bind(null,r)).catch(r.oe)}},watch:{searchContent:function(e,t){""===e?this.showView="view1":e.length>=1&&!/^[0-9a-z]*$/.test(e)&&this.watchInput()}},onShow:function(){},mounted:function(){this.getHotGoods(),this.historyList=JSON.parse(e.getStorageSync("historyList")||"[]")},onLoad:function(e){if(e&&e.searchContent){var t=JSON.parse(decodeURIComponent(e.searchContent));this.isCategorySearch=!0,this.categoryId=t,this.categorySearchGoods(t,""),console.log(this.searchContent)}else this.focus=!0},created:function(){},computed:{filteredSearchResultsList:function(){var e=this;if(console.log("筛选执行"),this.searchResults!=[]&&null!=this.searchResults)return 0==this.useFilterRule.manufacturer.length&&0==this.useFilterRule.goodsName.length?this.searchResults:this.searchResults.filter((function(t){var r=e.useFilterRule.manufacturer.some((function(e){return e===t.manufacturer})),s=e.useFilterRule.goodsName.some((function(e){return e===t.goodsName}));return 0==e.useFilterRule.manufacturer.length?s:0==e.useFilterRule.goodsName.length?r:r||s}))}},methods:{toReserveGoods:function(){e.switchTab({url:"/pages/goods_order/goods_order"})},clickFilterRule:function(t,r,s){if(e.showToast({title:"正在筛选",icon:"none"}),"生产厂商"==s){var o=this.useFilterRule.manufacturer.findIndex((function(e){return e===t}));-1===o?this.useFilterRule.manufacturer.push(t):this.useFilterRule.manufacturer.splice(o,1)}else if("品牌名"==s){var a=this.useFilterRule.goodsName.findIndex((function(e){return e===t}));-1===a?this.useFilterRule.goodsName.push(t):this.useFilterRule.goodsName.splice(a,1)}0!=this.useFilterRule.goodsName.length||0!=this.useFilterRule.manufacturer.length?this.useFilter=!0:this.useFilter=!1},getTagType:function(e,t){if("生产厂商"==t){var r=this.useFilterRule.manufacturer.some((function(t){return t===e}));return r?"primary":""}if("品牌名"==t){var s=this.useFilterRule.goodsName.some((function(t){return t===e}));return s?"primary":""}},createfilterRule:function(e){var t=new Set,r=new Set;e.forEach((function(e){t.add(e.manufacturer),r.add(e.goodsName)})),this.filterRule.manufacturer=Array.from(t),this.filterRule.goodsName=Array.from(r)},resetFilterRule:function(){this.useFilterRule.manufacturer=[],this.useFilterRule.goodsName=[],this.filterSearchResults=this.searchResults,this.useFilter=!1},toGoodsSellShop:function(t){e.navigateTo({url:"/pages/shops_selling_This_goods/shops_selling_This_goods?goods="+encodeURIComponent(JSON.stringify(t))})},selectBar:function(t,r){if("test4"!=t&&(this.choiceBar=t),"test3"==t)"大图"==this.showType?this.showType="列表":this.showType="大图";else{this.choiceBar=t;var s=this.searchObj.sortRule}return"test3"!=t&&e.pageScrollTo({scrollTop:0,duration:300}),"test0"==t&&(this.searchObj.sortRule="默认"),"test1"==t&&"price"==r?("价格升序"==s&&"价格降序"==s||(this.searchObj.sortRule="价格降序"),"价格升序"==s&&(this.searchObj.sortRule="价格降序"),"价格降序"==s&&(this.searchObj.sortRule="价格升序"),void this.sortSearchResults(this.searchObj.sortRule)):"test2"==t&&"shopsNum"==r?("报价数升序"==s&&"报价数降序"==s||(this.searchObj.sortRule="报价数降序"),"报价数升序"==s&&(this.searchObj.sortRule="报价数降序"),"报价数降序"==s&&(this.searchObj.sortRule="报价数升序"),void this.sortSearchResults(this.searchObj.sortRule)):("test4"==t&&this.$refs.popup.open("right"),void this.sortSearchResults(this.searchObj.sortRule))},sortSearchResults:function(e){"价格降序"==e&&(console.log(e),this.searchResults.sort((function(e,t){return t.minPrice-e.minPrice}))),"价格升序"==e&&this.searchResults.sort((function(e,t){return e.minPrice-t.minPrice})),"默认"==e&&this.searchResults.sort((function(e,t){return t.similarity-e.similarity})),"报价数降序"==e&&(console.log(e),this.searchResults.sort((function(e,t){return t.shopNum-e.shopNum}))),"报价数升序"==e&&this.searchResults.sort((function(e,t){return e.shopNum-t.shopNum})),this.removeDuplicates()},searchGoods:function(t,r){var s=this;return(0,n.default)(o.default.mark((function n(){var u,c,l,h;return o.default.wrap((function(o){while(1)switch(o.prev=o.next){case 0:if(s.showView="view3",s.isCategorySearch=!1,u=s,c=s.searchContent,""!=t&&(console.log("热门/记录搜索"+t),c=t,s.searchContent=t,s.resetFilterRule()),!/^[0-9]*$/.test(s.searchContent)){o.next=12;break}return console.log("纯数字-分类查询"),s.isCategorySearch=!0,s.categoryId=s.searchContent,o.next=11,s.categorySearchGoods(s.categoryId,"");case 11:return o.abrupt("return");case 12:if(s.searchObj.searchContent==c&&""!=c){o.next=20;break}s.searchTime=1,s.searchObj.pageIndex=1,s.searchObj.drugsList=[],s.searchResults=[],s.resetFilterRule(),o.next=22;break;case 20:if("loadMore"==r||""==s.searchContent){o.next=22;break}return o.abrupt("return");case 22:return s.saveSearchHistory(c),s.resetFilterRule(),1===u.searchTime&&(console.log(u.searchTime),u.searchTime=u.searchTime+1,e.showLoading({title:"搜索中..."})),u.searchObj.searchContent=c,"/api/goods/searchGoods","POST",l={searchObj:u.searchObj},o.prev=29,o.next=32,(0,i.default)("yzy_app","/api/goods/searchGoods","POST",l);case 32:h=o.sent,console.log(h),99==h.code&&(null!==h.data.data?(s.searchResults=[].concat((0,a.default)(s.searchResults),(0,a.default)(h.data.data)),u.totalNum=h.data.totalCount,s.searchObj.drugsList=h.data.drugsList,s.showView="view3",s.createfilterRule(s.searchResults)):(s.showView="view3",e.showToast({title:"没有找到该药品!",icon:"error",duration:1200})),0==!h.data.drugsList.length?s.sortSearchResults("报价数降序"):s.sortSearchResults(s.searchObj.sortRule)),e.hideLoading(),o.next=42;break;case 38:o.prev=38,o.t0=o["catch"](29),console.log(o.t0),e.hideLoading();case 42:case"end":return o.stop()}}),n,null,[[29,38]])})))()},categorySearchGoods:function(t,r){var s=this;return(0,n.default)(o.default.mark((function n(){var u,c,l,h;return o.default.wrap((function(o){while(1)switch(o.prev=o.next){case 0:if(s.showView="view3",u=s,c=t,s.searchObj.searchContent==c&&""!=c){o.next=11;break}s.searchTime=1,s.searchObj.pageIndex=1,s.searchObj.drugsList=[],s.searchResults=[],s.resetFilterRule(),o.next=13;break;case 11:if("loadMore"==r||""==s.searchContent){o.next=13;break}return o.abrupt("return");case 13:return s.resetFilterRule(),1===u.searchTime&&(console.log(u.searchTime),u.searchTime=u.searchTime+1,e.showLoading({title:"搜索中..."})),u.searchObj.searchContent=c,"/api/goods/searchGoods","POST",l={searchObj:u.searchObj},o.prev=19,o.next=22,(0,i.default)("yzy_app","/api/goods/searchGoods","POST",l);case 22:h=o.sent,console.log(h),99==h.code&&(null!==h.data.data?(s.searchResults=[].concat((0,a.default)(s.searchResults),(0,a.default)(h.data.data)),u.totalNum=h.data.totalCount,s.searchObj.drugsList=h.data.drugsList,s.showView="view3",s.createfilterRule(s.searchResults)):e.showToast({title:"没有找到该药品!",icon:"error",duration:1200}),0==!h.data.drugsList.length?s.sortSearchResults("报价数降序"):s.sortSearchResults(s.searchObj.sortRule)),e.hideLoading(),o.next=32;break;case 28:o.prev=28,o.t0=o["catch"](19),console.log(o.t0),e.hideLoading();case 32:case"end":return o.stop()}}),n,null,[[19,28]])})))()},removeDuplicates:function(){var e,t=[],r=u(this.searchResults);try{var s=function(){var r=e.value,s=t.some((function(e){return e.goodsId===r.goodsId}));s||t.push(r)};for(r.s();!(e=r.n()).done;)s()}catch(o){r.e(o)}finally{r.f()}this.searchResults=t},onReachBottom:function(){if(this.searchObj.pageIndex*this.searchObj.pageSize>=this.totalNum)return console.log("数据加载完毕"),void e.showToast({title:"数据加载完毕",icon:"success"});this.isloading||(this.searchObj.pageIndex++,console.log("到达底部"),this.isCategorySearch?this.categorySearchGoods(this.categoryId,"loadMore"):this.searchGoods("","loadMore"))},saveSearchHistory:function(t){console.log("存储搜索历史");var r=new Set(this.historyList);if(!/^[0-9]+$/.test(t)){0!==t.trim().length&&(r.delete(t.trim()),r.add(t.trim()));var s=Array.from(r);s.length>8&&r.delete(s[1]),this.historyList=Array.from(r).reverse(),e.setStorageSync("historyList",JSON.stringify(Array.from(r)))}},getHotGoods:function(){var e=this;return(0,n.default)(o.default.mark((function t(){var r,s;return o.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e,"/api/goods/searchGoods","POST",r={searchObj:{searchContent:"",pageIndex:1,pageSize:20,drugsList:[],sortRule:"默认",filterRule:"无"}},t.prev=4,t.next=7,(0,i.default)("yzy_app","/api/goods/searchGoods","POST",r);case 7:s=t.sent,99==s.code&&null!==s.data&&(e.hotList=s.data.data),t.next=14;break;case 11:t.prev=11,t.t0=t["catch"](4),console.log(t.t0);case 14:case"end":return t.stop()}}),t,null,[[4,11]])})))()},getMaySearch:function(){var e=this;return(0,n.default)(o.default.mark((function t(){var r,s;return o.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return"/api/goods/getMaySearch","POST",r={searchContent:e.searchContent},t.prev=3,t.next=6,(0,i.default)("yzy_app","/api/goods/getMaySearch","POST",r);case 6:s=t.sent,console.log(s),99==s.code&&(e.maySearchList=s.data.data),t.next=14;break;case 11:t.prev=11,t.t0=t["catch"](3),console.log(t.t0);case 14:case"end":return t.stop()}}),t,null,[[3,11]])})))()},watchInput:function(){""!=this.searchContent?(this.showView="view2",this.getMaySearch()):this.showView="view1"},clearSearchContent:function(){this.searchContent="",this.searchTime=1,this.searchObj.pageIndex=1,this.searchObj.drugsList=[]},clearSearchResult:function(){this.searchTime=1,this.searchObj.pageIndex=1,this.searchObj.drugsList=[],this.searchResults=[]}}};t.default=l}).call(this,r("543d")["default"])},c55f:function(e,t,r){"use strict";r.r(t);var s=r("1b8f"),o=r("c98b");for(var a in o)["default"].indexOf(a)<0&&function(e){r.d(t,e,(function(){return o[e]}))}(a);r("fcaf");var n=r("f0c5"),i=Object(n["a"])(o["default"],s["b"],s["c"],!1,null,null,null,!1,s["a"],void 0);t["default"]=i.exports},c98b:function(e,t,r){"use strict";r.r(t);var s=r("31fa"),o=r.n(s);for(var a in s)["default"].indexOf(a)<0&&function(e){r.d(t,e,(function(){return s[e]}))}(a);t["default"]=o.a},ebc3:function(e,t,r){"use strict";(function(e,t){var s=r("4ea4");r("7711");s(r("66fd"));var o=s(r("c55f"));e.__webpack_require_UNI_MP_PLUGIN__=r,t(o.default)}).call(this,r("bc2e")["default"],r("543d")["createPage"])},fcaf:function(e,t,r){"use strict";var s=r("0cd0"),o=r.n(s);o.a}},[["ebc3","common/runtime","common/vendor"]]]);