(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["subPackage_appointment/choose_doctor/choose_doctor"],{1966:function(e,t,n){"use strict";(function(e){var o=n("4ea4");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=o(n("2eee")),i=o(n("c973")),s=o(n("24db")),c={data:function(){return{doctor:[],hospital:null,departmentSubClass:{},sevenDays:[],selectedIndex:0,selectedDate:null,filterDoctor:[],clickDoctor:null,schedule:null,day:""}},onLoad:function(e){this.hospital=JSON.parse(decodeURIComponent(e.hospital)),this.departmentSubClass=JSON.parse(decodeURIComponent(e.departmentSubClass)),this.generateSevenDays()},mounted:function(){this.selectDay(0)},methods:{toSubmitAppointment:function(t){console.log(t);var n=this.departmentSubClass.departmentName?this.departmentSubClass.departmentName:"";e.redirectTo({url:"/subPackage_appointment/appointment/submit_appointment?date="+encodeURIComponent(JSON.stringify(this.selectedDate))+"&schedule="+encodeURIComponent(JSON.stringify(t))+"&hospital="+encodeURIComponent(JSON.stringify(this.hospital))+"&departmentInfo="+encodeURIComponent(JSON.stringify(n+"-"+this.departmentSubClass.subclassName))+"&doctor="+encodeURIComponent(JSON.stringify(this.clickDoctor.name+" "+this.clickDoctor.position))})},setSchedule:function(){if(this.clickDoctor&&this.clickDoctor.schedule){var e=new Date(this.selectedDate),t=(e.toISOString().split("T")[0],this.clickDoctor.schedule.filter((function(t){var n=new Date(t.startWorkTime),o=new Date(t.endWorkTime);return e>=n&&e<=o})));this.schedule=t}},openChooseSchedule:function(e){this.clickDoctor=e,this.setSchedule(),this.$refs.popup.open("right")},filterDoctorsByDate:function(){console.log("筛选医生");for(var e=this.selectedDate,t=this.day,n=[],o=this.doctor.length,a=0;a<o;a++){var i=this.doctor[a];if(i.schedule)for(var s=i.schedule.length,c=0;c<s;c++){var r=i.schedule[c],u=new Date(r.startWorkTime),d=new Date(r.endWorkTime),l=new Date(e),p="周六"===t||"周日"===t,h="y"===r.isWeekendWork;if(l>=u&&l<=d&&(!p||h)){n.push(i);break}}}console.log(n),this.filterDoctor=n},calculateRemainedNum:function(){this.filterDoctor.forEach((function(e){var t=0;e.schedule&&e.schedule.forEach((function(e){t+=(e.limitNum||0)-(e.alreadyAppointmentNum||0)})),e.remainedNum=t}))},generateSevenDays:function(){for(var e=["周日","周一","周二","周三","周四","周五","周六"],t=new Date,n=0;n<7;n++){var o=new Date(t);o.setDate(t.getDate()+n);var a=e[o.getDay()],i=(o.getMonth()+1).toString().padStart(2,"0"),s=o.getDate().toString().padStart(2,"0"),c="".concat(i,"-").concat(s);0===n?this.sevenDays.push({date:c,day:"今天"}):this.sevenDays.push({date:c,day:a})}},selectDay:function(t){e.showLoading({title:"loading...",mask:!0});var n=new Date,o=n.getFullYear();this.selectedIndex=t,this.selectedDate=o+"-"+this.sevenDays[t].date,this.day=this.sevenDays[t].day;this.getDoctor(this.selectedDate,"day")},getDoctor:function(t,n){var o=this;return(0,i.default)(a.default.mark((function i(){var c,r,u;return a.default.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return c=o,"/api/appointment/getDoctor","POST",r={departmentSubClassId:o.departmentSubClass.id,hospitalId:o.hospital.id,type:n,date:t},a.prev=4,a.next=7,(0,s.default)("yzy_app","/api/appointment/getDoctor","POST",r);case 7:u=a.sent,console.log(u),99==u.code&&u.data.data?"week"==n?(o.doctor=u.data.data,setTimeout((function(){c.calculateRemainedNum(),e.hideLoading()}),500)):(o.doctor=u.data.data,setTimeout((function(){c.filterDoctorsByDate(),c.calculateRemainedNum(),e.hideLoading()}),500)):e.showToast({title:"没有查到任何数据",icon:"none"}),a.next=15;break;case 12:a.prev=12,a.t0=a["catch"](4),console.log(a.t0);case 15:case"end":return a.stop()}}),i,null,[[4,12]])})))()}}};t.default=c}).call(this,n("543d")["default"])},"30ce":function(e,t,n){"use strict";n.r(t);var o=n("1966"),a=n.n(o);for(var i in o)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return o[e]}))}(i);t["default"]=a.a},"55ee":function(e,t,n){"use strict";var o=n("8021"),a=n.n(o);a.a},6846:function(e,t,n){"use strict";n.d(t,"b",(function(){return a})),n.d(t,"c",(function(){return i})),n.d(t,"a",(function(){return o}));var o={uniPopup:function(){return n.e("uni_modules/uni-popup/components/uni-popup/uni-popup").then(n.bind(null,"0336"))}},a=function(){var e=this.$createElement,t=(this._self._c,this.filterDoctor.length);this.$mp.data=Object.assign({},{$root:{g0:t}})},i=[]},8021:function(e,t,n){},"86bd":function(e,t,n){"use strict";n.r(t);var o=n("6846"),a=n("30ce");for(var i in a)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(i);n("55ee");var s=n("f0c5"),c=Object(s["a"])(a["default"],o["b"],o["c"],!1,null,null,null,!1,o["a"],void 0);t["default"]=c.exports},"874e":function(e,t,n){"use strict";(function(e,t){var o=n("4ea4");n("7711");o(n("66fd"));var a=o(n("86bd"));e.__webpack_require_UNI_MP_PLUGIN__=n,t(a.default)}).call(this,n("bc2e")["default"],n("543d")["createPage"])}},[["874e","common/runtime","common/vendor"]]]);