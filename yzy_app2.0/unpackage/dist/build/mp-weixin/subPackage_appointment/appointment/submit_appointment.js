(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["subPackage_appointment/appointment/submit_appointment"],{"0f0d":function(e,t,n){"use strict";n.r(t);var o=n("288a"),s=n("983e");for(var a in s)["default"].indexOf(a)<0&&function(e){n.d(t,e,(function(){return s[e]}))}(a);n("a008");var i=n("f0c5"),r=Object(i["a"])(s["default"],o["b"],o["c"],!1,null,null,null,!1,o["a"],void 0);t["default"]=r.exports},"1a6f":function(e,t,n){"use strict";(function(e){var o=n("4ea4");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s,a=o(n("2eee")),i=o(n("9523")),r=o(n("c973")),u=o(n("278c")),l=o(n("24db")),d={data:function(){return{hospital:{hospitalName:"",location:""},disabled:!1,persons:[],appointmentDate:null,selectPersonIndex:null,selectPersonId:null,selectPerson:null,morningSlots:["9:00","9:30","10:00","10:30","11:00","11:30"],afternoonSlots:["14:00","14:30","15:00","15:30","16:00","16:30","17:00","17:30"],selectedTime:null,department:["内科","外科"],selectedDepartment:null,countdown:30,timer:null,buttonLabel:"确认",patientPhone:"",validInput:!1,schedule:null,departmentInfo:"",doctor:""}},onShow:function(){this.getGoodsUser()},onLoad:function(e){this.hospital=JSON.parse(decodeURIComponent(e.hospital)),this.appointmentDate=JSON.parse(decodeURIComponent(e.date)),this.schedule=JSON.parse(decodeURIComponent(e.schedule)),this.departmentInfo=JSON.parse(decodeURIComponent(e.departmentInfo)),this.doctor=JSON.parse(decodeURIComponent(e.doctor))},beforeDestroy:function(){clearInterval(this.timer)},methods:(s={generateTimeSlots:function(e){for(var t=e.split("~"),n=(0,u.default)(t,2),o=n[0],s=n[1],a=o.split(":").map(Number),i=(0,u.default)(a,2),r=i[0],l=(i[1],s.split(":").map(Number)),d=(0,u.default)(l,2),c=d[0],p=(d[1],[]),h=r;h<=c;h++)for(var f=0;f<60;f+=30){var m=h.toString().padStart(2,"0"),g=f.toString().padStart(2,"0");p.push("".concat(m,":").concat(g))}return p},initTimeSlot:function(){var e=this.schedule.moringWorkHours,t=this.schedule.afternoonWorkHours;this.morningSlots=this.generateTimeSlots(e),this.afternoonSlots=this.generateTimeSlots(t)},onInput:function(){var e=this.patientPhone,t=e.replace(/[^\d]/g,"");this.validInput=!1,/^\d{11}$/.test(t)?(console.log("hefa"),this.patientPhone=t,this.validInput=!0):this.patientPhone=t.slice(0,11)}},(0,i.default)(s,"onInput",(function(){var e=this.patientPhone,t=e.replace(/\D/g,"");this.validInput=!1,t.length>11?this.patientPhone=t.slice(0,11):(this.patientPhone=t,/^1[3456789]\d{9}$/.test(t)&&(this.validInput=!0))})),(0,i.default)(s,"submit",(function(){var t=this;return(0,r.default)(a.default.mark((function n(){var o,s,i;return a.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return e.showLoading({title:" 预约中...",mask:!0}),o={openid:e.getStorageSync("openid"),appointmentUserPhone:e.getStorageSync("phone"),patientName:t.selectPerson.goodsUserName,patientPhone:t.selectPerson.phone,appointmentTime:t.appointmentDate,appointmentHospitalId:t.hospital.id,appointmentDoctorScheduleId:t.schedule.id,departmentId:t.schedule.departmentId},"/api/appointment/generateAppointment","POST",s=o,n.prev=5,n.next=8,(0,l.default)("yzy_app","/api/appointment/generateAppointment","POST",s);case 8:i=n.sent,console.log(i),99==i.data.flag?(e.showToast({title:"预约成功!请按时前往预约点",icon:"none",mask:!0,duration:1300}),setTimeout((function(){e.redirectTo({url:"/subPackage_appointment/user_queryAppointment/user_queryAppointment"})}),1300)):e.showToast({title:"预约失败!"+i.data.sm,icon:"none",mask:!0}),n.next=17;break;case 13:n.prev=13,n.t0=n["catch"](5),console.log(n.t0),e.hideLoading();case 17:console.log(s);case 18:case"end":return n.stop()}}),n,null,[[5,13]])})))()})),(0,i.default)(s,"clickSubmit",(function(){this.selectPersonId?this.validInput?this.disabled?e.showToast({title:"您的预约太频繁",icon:"none",duration:2e3}):(this.startCountdown(),this.submit()):e.showToast({title:"请正确输入电话号码",icon:"none",duration:2e3}):e.showToast({title:"请正确输入/选择必填项",icon:"none",duration:2e3})})),(0,i.default)(s,"startCountdown",(function(){var e=this;this.disabled=!0,this.buttonLabel="".concat(this.countdown," s"),this.timer=setInterval((function(){e.countdown>0?(e.countdown--,e.buttonLabel="".concat(e.countdown," s")):e.stopCountdown()}),1e3)})),(0,i.default)(s,"stopCountdown",(function(){clearInterval(this.timer),this.disabled=!1,this.buttonLabel="确认",this.countdown=30})),(0,i.default)(s,"selectDepartment",(function(e){this.selectedDepartment=e})),(0,i.default)(s,"selectTime",(function(e){this.selectedTime=e})),(0,i.default)(s,"checkPerson",(function(){console.log("toaddgoodsuser"),e.navigateTo({url:"/pages/goods_user/goods_user?openAddUser=true"})})),(0,i.default)(s,"getGoodsUser",(function(){var t=this;return(0,r.default)(a.default.mark((function n(){var o,s,i;return a.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return"/api/user/getGoodsUser","POST",o={openid:e.getStorageSync("openid"),phone:e.getStorageSync("phone")},n.prev=3,n.next=6,(0,l.default)("yzy_app","/api/user/getGoodsUser","POST",o);case 6:s=n.sent,console.log(s),99==s.code?(t.persons=s.data.data,null==t.persons&&0==t.persons.length||(t.persons.sort((function(e,t){return"本人"===e.relationship&&"本人"!==t.relationship?-1:"本人"!==e.relationship&&"本人"===t.relationship?1:"本人"===e.relationship&&"本人"===t.relationship?e.id-t.id:0})),i=t.persons.findIndex((function(e){return"本人"===e.relationship})),-1!==i?(t.selectPersonIndex=i,t.selectPersonId=t.persons[i].id,t.selectPerson=t.persons[i]):t.persons.length)):(e.$showMsg(s.msg,3e3),t.hasNextSmarthosId=!1),n.next=15;break;case 11:n.prev=11,n.t0=n["catch"](3),e.$showMsg(n.t0,3e3),t.hasNextSmarthosId=!1;case 15:case"end":return n.stop()}}),n,null,[[3,11]])})))()})),(0,i.default)(s,"calculateAge",(function(e){var t=new Date(e.substr(0,4),e.substr(4,2)-1,e.substr(6,2)),n=new Date,o=n-t,s=Math.floor(o/31536e6);return s})),s)};t.default=d}).call(this,n("543d")["default"])},"288a":function(e,t,n){"use strict";n.d(t,"b",(function(){return s})),n.d(t,"c",(function(){return a})),n.d(t,"a",(function(){return o}));var o={uniForms:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uni-forms/components/uni-forms/uni-forms")]).then(n.bind(null,"ad9b"))},uniFormsItem:function(){return n.e("uni_modules/uni-forms/components/uni-forms-item/uni-forms-item").then(n.bind(null,"35bd"))},uniEasyinput:function(){return n.e("uni_modules/uni-easyinput/components/uni-easyinput/uni-easyinput").then(n.bind(null,"9d07"))}},s=function(){var e=this,t=e.$createElement,n=(e._self._c,e.__map(e.persons,(function(t,n){var o=e.__get_orig(t),s=e.calculateAge(t.birthday);return{$orig:o,m0:s}})));e._isMounted||(e.e0=function(t,n,o){var s=arguments[arguments.length-1].currentTarget.dataset,a=s.eventParams||s["event-params"];n=a.index,o=a.person;e.selectPersonIndex=n,e.selectPersonId=o.id,e.selectPerson=o}),e.$mp.data=Object.assign({},{$root:{l0:n}})},a=[]},"66a4":function(e,t,n){"use strict";(function(e,t){var o=n("4ea4");n("7711");o(n("66fd"));var s=o(n("0f0d"));e.__webpack_require_UNI_MP_PLUGIN__=n,t(s.default)}).call(this,n("bc2e")["default"],n("543d")["createPage"])},"983e":function(e,t,n){"use strict";n.r(t);var o=n("1a6f"),s=n.n(o);for(var a in o)["default"].indexOf(a)<0&&function(e){n.d(t,e,(function(){return o[e]}))}(a);t["default"]=s.a},a008:function(e,t,n){"use strict";var o=n("e390"),s=n.n(o);s.a},e390:function(e,t,n){}},[["66a4","common/runtime","common/vendor"]]]);